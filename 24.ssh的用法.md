# ssh: secure shell

<br>

主机密钥分为两种
###### Secret key: 私有密钥
###### Public key: 公有密钥

<br>

linux: openSSH C/S 
###### 服务器: sshd	/etc/ssh/sshd_config
###### 客户端: ssh		/etc/ssh/ssh_config

<br>

安装openssh服务所需要的安装包
```shell
[root@zhangyz ~]# rpm -qa | grep ssh
openssh-server-5.3p1-117.el6.x86_64
openssh-clients-5.3p1-117.el6.x86_64
libssh2-1.4.2-2.el6_7.1.x86_64
openssh-5.3p1-117.el6.x86_64
```

<br>

刚才运行的命令有这些包是因为ssh服务已经被安装了如果没有安装需要运行以下命令
```shell
[root@zhangyz ~]# yum -y install openssh-server openssh-clients libssh2 openssh
Loaded plugins: fastestmirror, security
Setting up Reinstall Process
base                                                                                                                                                                                         | 3.7 kB     00:00     
base/primary_db                                                                                                                                                                              | 4.7 MB     00:08     
extras                                                                                                                                                                                       | 3.4 kB     00:00     
extras/primary_db                                                                                                                                                                            |  30 kB     00:00     
updates                                                                                                                                                                                      | 3.4 kB     00:00     
updates/primary_db                                                                                                                                                                           | 7.0 MB     00:13     
Installed package openssh-server-5.3p1-117.el6.x86_64 (from anaconda-CentOS-201605220104.x86_64) not available.
Installed package openssh-clients-5.3p1-117.el6.x86_64 (from anaconda-CentOS-201605220104.x86_64) not available.
Installed package openssh-5.3p1-117.el6.x86_64 (from anaconda-CentOS-201605220104.x86_64) not available.
Resolving Dependencies
--> Running transaction check
---> Package libssh2.x86_64 0:1.4.2-2.el6_7.1 will be reinstalled
--> Finished Dependency Resolution

Dependencies Resolved

==========================================================================================================================================================================================
Package                                Arch                                       Version                                             Repository                                      Size
==========================================================================================================================================================================================
installing:
libssh2                               x86_64                                  1.4.2-2.el6_7.1                                            base                                         123 k

Transaction Summary

Total download size: 123 k
Installed size: 318 k
Downloading Packages:
libssh2-1.4.2-2.el6_7.1.x86_64.rpm                                                                                                                                                           | 123 kB     00:00     
warning: rpmts_HdrFromFdno: Header V3 RSA/SHA1 Signature, key ID c105b9de: NOKEY
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
Importing GPG key 0xC105B9DE:
Userid : CentOS-6 Key (CentOS 6 Official Signing Key) <centos-6-key@centos.org>
Package: centos-release-6-8.el6.centos.12.3.x86_64 (@anaconda-CentOS-201605220104.x86_64/6.8)
From   : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
Installing : libssh2-1.4.2-2.el6_7.1.x86_64                                                                                                                                                                   1/1 
Verifying  : libssh2-1.4.2-2.el6_7.1.x86_64                                                                                                                                                                   1/1 

Installed:
libssh2.x86_64 0:1.4.2-2.el6_7.1                                                                                                                                                                                  

Complete!
```


使用ssh-keygen生成公钥和私钥
```shell
[root@zhangyz ~]# ssh-keygen 
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
45:44:66:99:75:a3:0c:d1:16:e2:df:fe:f0:0f:43:6d root@tradeqq_user_database
The key's randomart image is:
+--[ RSA 2048]----+
|         oX*o.o  |
|         =o+oo . |
|          o.o    |
|         . . . . |
|        S   . o E|
|             o . |
|              =  |
|               * |
|                =|
+-----------------+
```

使用ssh登陆linux服务器正常途径登陆方法,在提示之后正确输入密码即可登陆
```shell
[root@zhangyz ~]# ssh root@10.203.206.234
The authenticity of host '10.203.206.234 (10.203.206.234)' can't be established.
RSA key fingerprint is 54:1e:c9:05:bc:57:a9:42:64:98:c5:5c:72:6c:aa:3e.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '10.203.206.234' (RSA) to the list of known hosts.
root@10.203.206.234's password: 
[root@web01 ~]#
```

以上命令输入完成之后会为用户自动生成公钥和私钥,生成完成之后
```shell
[root@zhangyz ~]# ls /root/.ssh/
id_rsa  id_rsa.pub  known_hosts
```


ssh-copy-id
scp                 可以在两台主机之间复制数据
-r  
-a

ssh USERNAME@HOST 'COMMAND'




ssh  USERNAME

ssh -l username host             


ssh hadoop@192.168.1.1 "ls -l"




ssh-keygen -t rsa -f .ssh/id_rsa -P ' '          


ssh-keygen
-t rsa
~/.ssh/id_rsa
~/.ssh/id_rsa.pub
-f /path/to/KEY_FILE
-P ' '：指定加密私钥的密钥


dropbear：嵌入式系统专用的ssh服务器端和客户端工具
服务器端：dropbear
dropbearkey   
客户端：dbclient


dropbear默认使用nsswitch实现名称解析
/etc/nsswitch.conf
/lib/libnss_files*
/usr/lib/libnss3.so
/usr/lib/libnss_files*


dropbear会在用户登录检查其默认shell是否当前系统的安装shell
/etc/shells

tty             显示伪终端


主机密钥默认位置
/etc/dropbear
RSA：dropbear_rsa_host_key
长度可变，只要是8的整数倍，默认为1024
DSS：dropbear_dss_host_key
长度固定，默认为1024






telnet      23

客户端：
Linux： ssh
Windows： putty，secureCRT（），SSHsecureShellClient




netstat
-t：查看tcp的连接状态
-u：查看udp的连接状态
-r：查看路由信息


========================================        

ssh  {ssh_config}
sshd    {sshd_config}

./etc/ssh



ssh -l root 192.168.1.1

当你第一次确认接受了该主机那么它会自动接受该主机

ssh root@192.168.1.1 ‘ifconfig’


基于密钥的认证

一台主机为客户端（基于某个用户实现）
1.生成一对密钥

2.将公钥传输至服务器端某用户的家目录下的.ssh/authorized_keys文件中
使用文件传输工具传输（ssh-copy-id，scp）

3.测试登陆



scp：基于ssh的远程复制命令，可以实现在主机之间传输数据
scp  【option】   SRC  DEST

REMOTE_MACHINE
UESRNAME@HOSTNAME：/path/to/somewhere



ssh-keygen
-t      {rsa/dsa}
-f      /path/to/keyfile
-N      'password'


ssh-keygen -t rsa -f .ssh/id_rsa -N ''       


ssh-copy-id -i .ssh/id_rsa.pub root@192.168.64.129



sftp


总结
1.密码应该经常换，且足够复杂
2.使用非默认的端口
3.限制登陆客户地址
4.禁止管理直接登陆
5.仅允许有限制的用户登陆
6.仅用基于密钥的认证
7.禁止使用版本1


嵌入式系统专用的ssh软件  dropbear




